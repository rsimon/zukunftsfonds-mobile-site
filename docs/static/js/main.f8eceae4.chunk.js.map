{"version":3,"sources":["store/State.js","i18n/index.js","CRM.js","search/ResultList.jsx","search/SearchInstructions.jsx","profiles/RelatedItems.js","ImageGroup.jsx","map/Curve.js","profiles/ActorProfile.jsx","profiles/PlaceProfile.jsx","profiles/Utils.js","search/SearchPageMobile.jsx","search/SearchPageDesktop.jsx","map/OverviewMap.jsx","projects/SerbsInVienna.jsx","projects/CampOberhollabrunn.jsx","splash/SplashPageDesktop.jsx","help/Help.jsx","tour/Tour.js","PageWithMenuMobile.jsx","tour/map/MyPosition.jsx","tour/map/NextStop.jsx","tour/mobile/InfoPanel.jsx","tour/mobile/WaypointPage.jsx","tour/mobile/StartPage.jsx","tour/desktop/WaypointPage.jsx","tour/desktop/StartPage.jsx","SideMenu.jsx","PageWithMenuDesktop.jsx","PageWithMenu.jsx","splash/SplashPageMobile.jsx","App.js","splash/LoadingScreen.jsx","serviceWorker.js","store/DataStore.js","index.js","i18n sync /^/.//messages_.*/.json$"],"names":["languageState","atom","key","default","window","localStorage","getItem","searchQueryState","searchResultState","i18n","loadMessages","lang","messages","require","t","label","this","useI18N","useRecoilValue","useLang","useBilingual","trim","str","replace","description","indexOf","split","CRM","ICONS","E18_Physical_Thing","E21_Person","E74_Group","ResultList","props","Row","index","style","item","results","className","onClick","onSelect","modifier","icon","crmClass","properties","title","height","width","itemCount","length","itemSize","SearchInstructions","distinct","items","uris","map","filter","pos","RelatedItems","store","relevantTypes","P74_has_current_or_former_residence","OA8_begins_in","OA9_ends_in","places","relations","rel","includes","relationType","resolved","getPlaceWithLocation","relationTo","relation","p","obj","begins_in","ends_in","has_residence","all","location","find","P53_has_former_or_current_location","getActorsWithLocation","getRelatedItems","getValidDepictions","depictions","d","url","hasDepictions","ImageGroup","useState","selected","setSelected","images","idx","src","alt","placeholder","backgroundColor","mainSrc","prevSrc","prevIdx","getPrev","nextSrc","nextIdx","getNext","imageCaption","onMovePrevRequest","onMoveNextRequest","onCloseRequest","Curve","fromLatLon","toLatLon","curveLayer","markerLayer","opts","handler","curve","on","handles","h","pathOptions","color","weight","offsetX","offsetY","r","Math","sqrt","pow","theta","atan2","thetaOffset","PI","r2","cos","theta2","midpointX","data","sin","L","addTo","bringToBack","handleStyle","stroke","fillColor","handleColor","fillOpacity","radius","circleMarker","ActorProfile","mapRef","useRef","getTranslation","navigator","relatedPlaces","geometries","hasGeometry","centroids","geom","centroid","geometry","coordinates","reverse","useEffect","current","leafletElement","fitBounds","bboxes","bbox","corners","min","apply","max","getUnionBounds","padding","start","end","drawArrow","PageWithMenu","backButton","Map","ref","zoomControl","attributionControl","isDesktop","TileLayer","GeoJSON","value","dataSource","renderHeader","renderRow","navigateTo","PlaceProfile","hasGeom","geojson","getBounds","actors","PROFILE_COMPONENTS","getProfileComponent","_","pushPage","component","type","SearchPage","useRecoilState","search","setSearch","setResults","onSearch","evt","query","target","toLowerCase","searchAll","onClearSearch","renderToolbar","onChange","result","DesktopSearchPage","OverviewMap","geoBounds","layerGroup","paths","forEach","begins","ends","Object","values","getDistinctPaths","lifePaths","l","path","actor","placeStyle","weigth","feature","slice","lonLat","CircleMarker","center","zoom","preferCanvas","DESCRIPTION_GERMAN","href","DESCRIPTION_ENGLISH","PAGE_TITLE","TEXT_TITLE","DESCRIPTION","SerbsInVienna","content","CampOberhollabrunn","SplashPageDesktop","goTo","SPLASH_MESSAGE","SearchPageDeskop","de","en","TITLE","CONTENT","Help","Tour","getNearestWaypoint","currentPos","coords","longitude","latitude","distances","waypoints","features","f","distance","minDistance","tour","Promise","axios","get","then","track","waypoint","record","findById","id","every","coord","isNaN","join","viewpoint","lonlat","buildWaypointFeatures","bounds","name","language","getProp","loadTour","load","PageWithMenuMobile","isMenuOpen","setMenuOpen","onDeviceBackButton","popPage","children","animation","mode","side","collapse","isOpen","onClose","OUTER_STYLE","INNER_STYLE","MyPosition","LayerGroup","NextStop","Pane","zIndex","JSON","stringify","InfoPanel","main","expanded","setExpanded","next","dist","round","proximity","useGPS","scrollTop","vibrate","headerImage","startsWith","CSSTransition","in","timeout","isStart","isEnd","waypointIdx","backgroundImage","para","onReturn","onNextWaypoint","onPreviousWaypoint","PATH_STYLE","dashArray","WaypointPage","setWaypoint","setPos","currentIdx","lons","lats","paddingTopLeft","paddingBottomRight","innerHeight","watchId","geolocation","watchPosition","enableHighAccuracy","clearWatch","TourStartPage","setTour","onStartTour","image","duration","dangerouslySetInnerHTML","__html","getDescription","onPrevWaypoint","StartPage","SideMenu","setLanguage","onChangeLanguage","setItem","mobileComponent","optDesktopComponent","pages","pageName","SplashPageMobile","SearchPageMobile","SearchPageDesktop","MobileTour","DesktopTour","inputId","checked","htmlFor","PageWithMenuDesktop","document","PageWithenu","SplashPage","App","nav","onpopstate","splashPage","renderPage","route","React","createElement","uuid","initialRoute","onPostPush","routes","pushedRoute","history","pushState","swipeable","LoadingScreen","indeterminate","Boolean","hostname","match","DataStore","JsSearch","tokenizer","tokenize","text","addIndex","loadFile","entityType","response","reduce","concat","arr","allCoords","g","Array","isArray","minLon","maxLon","computeGeoBounds","sort","a","b","aBegins","aEnds","bBegins","bEnds","computeLifePaths","addDocuments","i","place","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","Launcher","screen","availWidth","isLoading","setIsLoading","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister","catch","error","console","message","webpackContext","req","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","resolve","module","exports"],"mappings":"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","file":"static/js/main.f8eceae4.chunk.js","sourcesContent":["import { atom } from 'recoil';\n\nexport const languageState = atom({\n  key: 'language',\n  default: window.localStorage.getItem('zukunftsfonds.language') || 'en'\n});\n\nexport const searchQueryState = atom({\n  key: 'searchQuery',\n  default: ''\n});\n\nexport const searchResultState = atom({\n  key: 'searchResults',\n  default: []\n});","import { useRecoilValue } from 'recoil';\nimport { languageState } from '../store/State';\n\nclass I18N {\n\n  constructor() {\n    this.messages = {};\n\n    // For potential future extension\n    this.loadMessages('de');\n  }\n\n  loadMessages = lang => {\n    this.messages[lang] = require(`./messages_${lang}.json`);\n  }\n\n  t = lang => label =>\n    lang in this.messages && label in this.messages[lang] ?\n      this.messages[lang][label] : label;\n\n}\n\nconst i18n = new I18N();\n\n// Wrapping I18N into a cool helper hook\nexport const useI18N = () => {\n\n  const lang = useRecoilValue(languageState);\n  return i18n.t(lang);\n\n}\n\n// Just a shorthand to use current language setting more easily\nexport const useLang = ()  =>\n  useRecoilValue(languageState)\n\n// Helper to handle the ad-hoc 'bilingual' description format of the project\nexport const useBilingual = () => {\n  \n  const lang = useRecoilValue(languageState);\n\n  // Helper to remove trailing + leading whitespace and dashes\n  const trim = str =>\n    str.replace(/^[-,\\s]+ | [-,\\s]+$/g, '');\n \n  return description => {\n    // Project convention is to use 12 dash characters as separators. Anyways,\n    // people aren't doing this consistently, sometimes using more or fewer dashes.\n    // We'll split on everything thats more than 9 consecutive dashes.\n    if (description.indexOf('---------') === -1) {\n      return description;\n    } else {\n      return lang === 'de' ? trim(description.split('---------')[0]) : trim(description.split('---------')[1]);\n    }\n  }\n\n}","const CRM = {\n\n  'E18_Physical_Thing': 'crm:E18 Physical Thing',\n  'E21_Person': 'crm:E21 Person',\n  'E74_Group': 'crm:E74 Group',\n\n  'OA8_begins_in': 'crm:OA8 begins in',\n  'OA9_ends_in': 'crm:OA9 ends in',\n\n  'P53_has_former_or_current_location': 'crm:P53 has former or current location',\n  'P74_has_current_or_former_residence': 'crm:P74 has current or former residence'\n\n}\n\nexport default CRM;","import React from 'react';\nimport { FixedSizeList as List } from 'react-window';\nimport { Icon, Ripple } from 'react-onsenui';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport CRM from '../CRM';\n\nimport './ResultList.scss';\n\nconst ICONS = {\n  [CRM.E18_Physical_Thing]: 'md-pin',\n  [CRM.E21_Person]: 'md-account',\n  [CRM.E74_Group]: 'md-accounts'\n}\n\nconst ResultList = props => {\n\n  const Row = ({ index, style }) => {\n    const item = props.results[index];\n\n    return (<div \n      className=\"search-result\" \n      style={style}\n      onClick={() => props.onSelect(props.results[index])}>\n\n      <Ripple modifier=\"light-gray\" />\n\n      <Icon icon={ICONS[item.crmClass]} />\n\n      <label>{item.properties.title}</label>\n    </div>)\n  }\n\n  return (\n    <div className=\"search-results\">\n      <AutoSizer>\n        {({ height, width}) => (\n          <List \n            height={height}\n            itemCount={props.results.length}\n            itemSize={58}\n            width={width}>\n            {Row}\n          </List>\n          )\n        }\n      </AutoSizer>\n    </div>\n  )\n\n}\n\nexport default ResultList;","import React from 'react';\nimport { useLang } from '../i18n';\n\nconst SearchInstructions = props => {\n\n  const lang = useLang();\n\n  return (\n    <div className=\"instructions\">\n      {lang === 'en' ?\n        'Please enter the name of a person or place.' :\n        'Bitte geben Sie den Namen einer Person oder eines Ortes ein.'\n      }\n    </div>\n  )\n\n}\n\nexport default SearchInstructions;","import CRM from '../CRM';\n\n// De-duplicates the list of items, using their URI for equality\nconst distinct = items => {\n  const uris = items.map(item => item['@id']);\n  return items.filter((item, pos) => uris.indexOf(item['@id']) === pos);\n}\n\n/** Helper class to deal with related places/actors more easily **/\nclass RelatedItems {\n\n  constructor(item, store) {\n    this.item = item;\n    this.store = store;\n  }\n\n  /**\n   * If this item is an actor, it will have places connected to it.\n   * This method performs a \"forward lookup\", based on the links\n   * included in this item.\n   * \n   * Returns an object with the following properties:\n   * \n   * places.begins_in\n   * places.ends_in\n   * places.has_residence\n   * places.all\n   * \n   * TODO should we memoize this?\n   */\n  get places() {\n    // Pick up the following CRM types\n    const relevantTypes = [\n      CRM.P74_has_current_or_former_residence,\n      CRM.OA8_begins_in,\n      CRM.OA9_ends_in\n    ];\n\n    // Relations with these types\n    const relations = this.item.relations.filter(rel =>\n      relevantTypes.includes(rel.relationType));\n\n    // Resolve referred locations to places\n    const places = relations.map(rel => ({\n      label: rel.label, \n      relationType: rel.relationType,\n      resolved: this.store.getPlaceWithLocation(rel.relationTo)\n    }));\n\n    // Shorthand\n    const filter = relation =>\n      places.filter(p => p.relationType === relation).map(obj => obj.resolved);\n\n    // TODO add all unique places\n    return {\n      begins_in: filter(CRM.OA8_begins_in),\n      ends_in: filter(CRM.OA9_ends_in),\n      has_residence: filter(CRM.P74_has_current_or_former_residence),\n      all: distinct(places.map(p => p.resolved)) // TODO de-duplicate\n    }\n  }\n\n  /**\n   * If this item is a place, other items in the store will have\n   * connections to it. This method performs a \"reverse lookup\",\n   * fetching every actor from the store that references this\n   * place.\n   */\n  get actors() {\n    const location = this.item.relations.find(rel => \n      rel.relationType === CRM.P53_has_former_or_current_location);\n\n    return location ?\n      this.store.getActorsWithLocation(location.relationTo) : [];\n  }\n\n}\n\nexport const getRelatedItems = (item, store) =>\n  new RelatedItems(item, store);","import React, { useState } from 'react';\nimport Image from 'react-cool-img';\nimport Lightbox from 'react-image-lightbox';\n\nimport 'react-image-lightbox/style.css';\n\nconst getValidDepictions = depictions => depictions ? \n  depictions.filter(d => d.url.indexOf('http') === 0) : [];\n\nexport const hasDepictions = item =>\n  getValidDepictions(item.depictions).length > 0;\n\nconst ImageGroup = props => {\n\n  const [ selected, setSelected ] = useState(null);\n\n  const depictions = getValidDepictions(props.depictions);\n\n  const getPrev = idx => {\n    if (selected !== null && depictions.length > 1) {\n      const prevIdx = (depictions.length + selected - 1) % depictions.length;\n      return depictions[prevIdx].url + '?image_size=webview'\n    }\n  }\n\n  const getNext = idx => {\n    if (selected !== null && depictions.length > 1) {\n      const nextIdx = (selected + 1) % depictions.length;\n      return depictions[nextIdx].url + '?image_size=webview';\n    }\n  }\n\n  const images = depictions.map((d, idx) =>\n    <div key={d.url} className=\"image-wrapper\" onClick={() => setSelected(idx)}>\n      <Image \n        src={`${d.url}?image_size=thumbnail`}\n        alt={d.title} \n        placeholder=\"images/wait.svg\"\n        style={{ backgroundColor: '#dfdfdf' }} />\n\n      <div className=\"dim-mask\" />\n    </div>\n  );\n\n  return (\n    <>\n      <div className=\"image-group\">\n        { images }\n      </div>\n\n      {selected !== null && \n        <Lightbox \n          mainSrc={`${depictions[selected].url}?image_size=webview`} \n          prevSrc={getPrev()}\n          nextSrc={getNext()}\n          imageCaption={depictions[selected].title}\n          onMovePrevRequest={() => setSelected((depictions.length + selected - 1) % depictions.length)}\n          onMoveNextRequest={() => setSelected((selected + 1) % depictions.length)}\n          onCloseRequest={() => setSelected(null) } />\n      }\n    </>\n  )\n\n}\n\nexport default ImageGroup;","import L from 'leaflet';\n\nimport '@elfalem/leaflet-curve';\n\n/**\n * Modified from https://gist.github.com/ryancatalani/6091e50bf756088bf9bf5de2017b32e6\n */\n\nexport default class Curve {\n\n  constructor(fromLatLon, toLatLon, curveLayer, markerLayer, opts) {\n    const pathOptions = opts || {\n      color: '#a98f54',\n      weight: 3\n    };\n\n    const offsetX = toLatLon[1] - fromLatLon[1];\n    const offsetY = toLatLon[0] - fromLatLon[0];\n\n    const r = Math.sqrt(Math.pow(offsetX, 2) + Math.pow(offsetY, 2));\n    const theta = Math.atan2(offsetY, offsetX);\n\n    const thetaOffset = - (Math.PI / 10);\n\n    const r2 = (r / 2) / Math.cos(thetaOffset);\n    const theta2 = theta + thetaOffset;\n\n    const midpointX = (r2 * Math.cos(theta2)) + fromLatLon[1];\n    const midpointY = (r2 * Math.sin(theta2)) + fromLatLon[0];\n\n    const midpointLatLng = [ midpointY, midpointX ];\n\n    const data = [\n      'M', fromLatLon,\n      'Q', midpointLatLng,\n      toLatLon\n    ];\n\n    this.curve = L.curve(data, { ...pathOptions })\n      .addTo(curveLayer).bringToBack();\n\n    const handleStyle = {\n      stroke: false,\n      fillColor: pathOptions.handleColor || '#8a6100',\n      fillOpacity: 1,\n      radius: 6\n    }\n\n    this.handles = [\n      L.circleMarker(fromLatLon, handleStyle).addTo(markerLayer),\n      L.circleMarker(toLatLon, handleStyle).addTo(markerLayer)\n    ];\n  }\n\n  onClick = handler => {\n    this.curve.on('click', handler);\n    this.handles.map(h => h.on('click', handler));\n  }\n  \n}","import React, { useEffect, useRef } from 'react';\nimport { Icon, List, ListHeader, ListItem } from 'react-onsenui';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport bbox from '@turf/bbox';\nimport centroid from '@turf/centroid';\nimport { hasGeometry, navigateTo } from './Utils';\nimport { getRelatedItems } from './RelatedItems';\nimport PageWithMenu from '../PageWithMenu';\nimport { useI18N, useBilingual } from '../i18n';\nimport ImageGroup, { hasDepictions } from '../ImageGroup';\nimport Curve from '../map/Curve';\n\nimport './Profile.scss';\n\nconst getUnionBounds = geometries => {\n  const bboxes = geometries.map(geom => bbox(geom));\n\n  const corners = [\n    Math.min.apply(null, bboxes.map(t => t[0])),\n    Math.min.apply(null, bboxes.map(t => t[1])),\n    Math.max.apply(null, bboxes.map(t => t[2])),\n    Math.max.apply(null, bboxes.map(t => t[3]))\n  ];\n\n  return [ // Leaflet order\n    [ corners[1], corners[0] ],\n    [ corners[3], corners[2] ]\n  ];\n}\n\nconst ActorProfile = props => {\n\n  const i18n = useI18N();\n\n  const mapRef = useRef();\n\n  const getTranslation = useBilingual();\n\n  const { item, store, navigator } = props;\n\n  const relatedPlaces = getRelatedItems(item, store).places.all;\n\n  const geometries = relatedPlaces.filter(p => hasGeometry(p));\n\n  const centroids = geometries.map(geom =>\n    // GeoJSON - extract just coords, and flip to Leaflet order\n    centroid(geom).geometry.coordinates.reverse());\n\n  useEffect(() => {\n    const drawArrow = map => {\n      const [ start, end ] = centroids;      \n      new Curve(start, end, map, map);\n    }\n\n    if (mapRef.current && geometries.length > 0) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(getUnionBounds(geometries), { padding: [ 15, 15 ]});\n\n      if (centroids.length === 2)\n        drawArrow(map);\n    }\n  }, [ geometries, centroids ]);\n\n  return (\n    <PageWithMenu \n      backButton\n      className=\"profile actor\"\n      title={item.properties.title}\n      {...props}>\n\n      <div className=\"map-container\">\n        <Map \n          ref={mapRef}\n          zoomControl={false}\n          attributionControl={false}\n          style={props.isDesktop ? { height:'400px' }: { height:'200px' }}>\n          <TileLayer\n            url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}\"\n          />\n          {geometries.map(geom => \n            <GeoJSON key={geom['@id']} data={geom} />\n          )}\n        </Map>\n      </div>\n\n      { item.description.map((d, idx) => \n        <div key={idx} className=\"description\">{getTranslation(d.value)}</div>\n      )}\n\n      { hasDepictions(item) && \n        <ImageGroup depictions={item.depictions} />\n      }\n\n      <List\n        className=\"related places\"\n        dataSource={relatedPlaces}\n        renderHeader={() =>\n          <ListHeader>\n            <Icon icon=\"md-pin\" />\n            <label>{i18n('Places')}</label>\n          </ListHeader>\n        }\n        renderRow={(r, idx) => \n          <ListItem key={idx} className=\"related residence\" onClick={navigateTo(r, navigator)}>\n            <span className=\"title\">{r.properties.title}</span>\n          </ListItem>\n        } />\n    </PageWithMenu>\n  )\n\n}\n\nexport default ActorProfile;","import React, { useEffect, useRef } from 'react';\nimport { Icon, List, ListHeader, ListItem } from 'react-onsenui';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport bbox from '@turf/bbox';\nimport { getRelatedItems } from './RelatedItems';\nimport { navigateTo, hasGeometry } from './Utils';\nimport PageWithMenu from '../PageWithMenu';\nimport { useI18N, useBilingual } from '../i18n';\nimport ImageGroup, { hasDepictions } from '../ImageGroup';\n\nimport 'leaflet/dist/leaflet.css';\n\nimport './Profile.scss';\n\nconst getBounds = geojson => {\n  const corners = bbox(geojson);\n  return [ // Leaflet order\n    [ corners[1], corners[0] ],\n    [ corners[3], corners[2] ]\n  ];\n}\n\nconst PlaceProfile = props => {\n\n  const i18n = useI18N();\n\n  const getTranslation = useBilingual();\n\n  const mapRef = useRef();\n\n  const { item, navigator, store } = props;\n\n  const hasGeom = hasGeometry(item);\n\n  useEffect(() => {\n    if (mapRef.current && hasGeom) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(getBounds(item));\n    }\n  }, [ item, hasGeom ]);\n\n  const actors = getRelatedItems(item, store).actors;\n\n  return (\n    <PageWithMenu \n      backButton\n      className=\"profile place\"\n      title={item.properties.title}\n      {...props}>\n\n      <div className=\"map-container\">\n        <Map \n          ref={mapRef}\n          zoomControl={false}\n          attributionControl={false}>\n          <TileLayer\n            url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}\"\n          />\n          { hasGeom && <GeoJSON data={item} /> }\n        </Map>\n      </div>\n\n      { item.description && item.description.map((d, idx) => \n        <div key={idx} className=\"description\">{getTranslation(d.value)}</div>\n      )}\n\n      { hasDepictions(item) && \n        <ImageGroup depictions={item.depictions} />\n      }\n\n      <List\n        className=\"related actors\"\n        dataSource={actors}\n        renderHeader={() =>\n          <ListHeader>\n            <Icon icon=\"md-account\" />\n            <label>{i18n('People')}</label>\n          </ListHeader>\n        }\n        renderRow={(r, idx) => \n          <ListItem key={idx} className=\"related residence\" onClick={navigateTo(r, navigator)}>\n            <span className=\"title\">{r.properties.title}</span>\n          </ListItem>\n        } />\n    </PageWithMenu>\n  )\n\n}\n\nexport default PlaceProfile;","import ActorProfile from './ActorProfile';\nimport PlaceProfile from './PlaceProfile';\nimport CRM from '../CRM';\n\nconst PROFILE_COMPONENTS = {\n  [CRM.E18_Physical_Thing]: PlaceProfile,\n  [CRM.E21_Person]: ActorProfile,\n  [CRM.E74_Group]: ActorProfile\n}\n\n/** Returns the right JSX profile component for this item **/\nexport const getProfileComponent = item => \n  PROFILE_COMPONENTS[item.crmClass];\n\n/** Returns a handler function for navigating to the view appropriate to the given item **/\nexport const navigateTo = (item, navigator) => _ =>\n  navigator.pushPage({ component: getProfileComponent(item), item });\n\n/** Helper to determine whether the item has any non-empty geometries **/\nexport const hasGeometry = item => {\n  if (!item)\n    return false; \n\n  if (!item.geometry)\n    return false; \n\n  if (item.geometry.type === 'GeometryCollection')\n    return item.geometry.geometries?.length > 0 && item.geometry.geometries[0].coordinates;\n\n  return item.geometry?.coordinates?.length > 0;\n}\n","import React from 'react';\nimport { BackButton, Icon, Page, Input, Toolbar, ToolbarButton } from 'react-onsenui';\nimport ResultList from './ResultList';\nimport SearchInstructions from './SearchInstructions';\nimport { getProfileComponent } from '../profiles/Utils';\nimport { useRecoilState } from 'recoil';\nimport { searchQueryState, searchResultState } from '../store/State';\nimport { useI18N }from '../i18n';\n\nimport './SearchPage.scss';\n\nconst SearchPage = props => {\n\n  const i18n = useI18N();\n\n  // We'll keep search state global, so we can persist across page navigation\n  const [ search, setSearch ] = useRecoilState(searchQueryState);  \n  const [ results, setResults ] = useRecoilState(searchResultState);\n\n  const onSearch = evt => {\n    const query = evt.target.value.toLowerCase();\n\n    // For some weird reason, OnsenUI SearchInput also triggers\n    // onChange when losing focus, causing an unwanted re-render\n    if (search !== query) {\n      setSearch(query);\n\n      const results = props.store.searchAll(query);\n      setResults(results);\n    }\n  }\n\n  const onSelectResult = result =>\n    props.navigator.pushPage({ \n      component: getProfileComponent(result),\n      item: result \n    });\n\n  const onClearSearch = () => {\n    setSearch('');\n    setResults([]);\n  }\n\n  return (\n    <Page\n      className=\"search\"\n      renderToolbar={() => \n        <Toolbar>\n          <div className=\"left\">\n            <BackButton />\n          </div>\n\n          <div className=\"center\">\n            <Input\n              value={search}\n              placeholder={i18n('Search')}\n              onChange={onSearch} />\n          </div>\n          \n          <div className=\"right\">\n            <ToolbarButton>\n              <Icon icon=\"md-close\" onClick={onClearSearch} />\n            </ToolbarButton>\n          </div>\n        </Toolbar>\n      }>\n\n      {results.length > 0 ?\n        <ResultList\n          results={results} \n          onSelect={onSelectResult} /> : <SearchInstructions /> }\n    </Page>\n  )\n\n}\n\nexport default SearchPage;","import React from 'react';\nimport { Input } from 'react-onsenui';\nimport ResultList from './ResultList';\nimport SearchInstructions from './SearchInstructions';\nimport { getProfileComponent } from '../profiles/Utils';\nimport { useRecoilState } from 'recoil';\nimport { searchQueryState, searchResultState } from '../store/State';\nimport { useI18N }from '../i18n';\nimport PageWithMenuDesktop from '../PageWithMenuDesktop';\n\nimport './SearchPage.scss';\n\nconst DesktopSearchPage = props => {\n\n  const i18n = useI18N();\n\n  // We'll keep search state global, so we can persist across page navigation\n  const [ search, setSearch ] = useRecoilState(searchQueryState);  \n  const [ results, setResults ] = useRecoilState(searchResultState);\n\n  const onSearch = evt => {\n    const query = evt.target.value.toLowerCase();\n\n    // For some weird reason, OnsenUI SearchInput also triggers\n    // onChange when losing focus, causing an unwanted re-render\n    if (search !== query) {\n      setSearch(query);\n\n      const results = props.store.searchAll(query);\n      setResults(results);\n    }\n  }\n\n  const onSelectResult = result =>\n    props.navigator.pushPage({ \n      component: getProfileComponent(result, true),\n      item: result \n    });\n\n  return (\n    <PageWithMenuDesktop \n      className=\"search\"\n      current=\"Search\"\n      title=\"Search\"\n      {...props}>\n\n      <div className=\"center\">\n        <Input\n          value={search}\n          placeholder={i18n('Search')}\n          onChange={onSearch} />\n      </div>\n\n      {results.length > 0 ?\n        <ResultList\n          results={results} \n          onSelect={onSelectResult} /> : <SearchInstructions /> }\n    </PageWithMenuDesktop>\n  )\n\n}\n\nexport default DesktopSearchPage;","import React, { useEffect, useRef } from 'react';\nimport { Map, CircleMarker, TileLayer } from 'react-leaflet';\nimport centroid from '@turf/centroid';\nimport PageWithMenu from '../PageWithMenu';\nimport { useI18N } from '../i18n';\nimport { hasGeometry, navigateTo } from '../profiles/Utils';\nimport Curve from './Curve';\nimport L from 'leaflet';\n\nimport './OverviewMap.scss';\n\nconst drawArrow = (path, curveLayer, markerLayer, onClick) => {\n  const start = centroid(path.begins).geometry.coordinates.reverse();\n  const end = centroid(path.ends).geometry.coordinates.reverse();\n\n  const arrow = new Curve(\n    start, \n    end, \n    curveLayer, \n    markerLayer);\n\n  arrow.onClick(onClick);\n}\n\nconst getDistinctPaths = paths => {\n  const distinct =  {};\n\n  paths.forEach(p => {\n    // Path is defined by the URIs of its start & end\n    const key = `${p.begins['@id']}-${p.ends['@id']}`;\n    \n    // Keep only the last, so that we render only one arc\n    distinct[key] = p;\n  });\n\n  return Object.values(distinct);\n}\n\nconst OverviewMap = props => {\n\n  const i18n = useI18N();\n\n  const mapRef = useRef();\n\n  const onClick = path =>\n    navigateTo(path.actor, props.navigator);\n\n  useEffect(() => {\n    if (mapRef.current) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(props.store.geoBounds);\n\n      if (props.isDesktop) {\n        const curveLayer = L.layerGroup().addTo(map);\n        const markerLayer = L.layerGroup().addTo(map);\n\n        getDistinctPaths(props.store.lifePaths)\n          .forEach(l => drawArrow(l, curveLayer, markerLayer, onClick(l)));\n      }\n    }\n  });\n\n  const placeStyle = {\n    stroke: true,\n    weigth: 2,\n    color: '#8a6100',\n    fillColor: '#8a6100',\n    fillOpacity: 0.75,\n    radius: 5\n  }\n\n  const places = props.store.places.map(feature => {\n      if (hasGeometry(feature))\n        return {\n          feature,\n          centroid: centroid(feature.geometry).geometry.coordinates.slice().reverse()\n        }\n    })\n    .filter(lonLat => lonLat) // Remove unlocated\n    .map(({ feature, centroid}) =>\n      <CircleMarker \n        key={feature['@id']} \n        center={centroid} \n        onClick={navigateTo(feature, props.navigator)}\n        {...placeStyle} />\n    );\n\n  return (\n    <PageWithMenu \n      backButton\n      title=\"Map\"\n      className=\"overview-map\"\n      title={i18n('Map')}\n      {...props}>\n\n      <div className=\"overview-map-container\">\n        <Map \n          ref={mapRef}\n          zoom={10}\n          preferCanvas={true}\n          attributionControl={false}\n          style={{height:'100%'}}>\n          <TileLayer\n            url=\"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}\"\n          />\n\n          { places }\n\n        </Map>\n      </div>\n    </PageWithMenu>\n  )\n\n}\n\nexport default OverviewMap;","import React from 'react';\nimport PageWithMenu from '../PageWithMenu';\nimport { useLang } from '../i18n';\n\nconst DESCRIPTION_GERMAN = \n  <>\n    <p className=\"project-description\">\n      In diesem Forschungsprojekt wurden biographische Daten zu den orthodoxen \n      Wiener SerbInnen von 1741 bis 1918, und hier zu bedeutenden Persönlichkeiten \n      des politischen, sozialen, wirtschaftlichen, wissenschaftlichen und \n      kulturellen Lebens der Zeit, in den Wiener Archiven, zu ihren Wohnorten und \n      zu ihren Wirkungsst&auml;tten in Wien recherchiert. Die biographischen Abrisse und \n      Lokalisierungen von Wohnorten und Wirkungsstätten wurden in eine OpenAtlas \n      Datenbank eingegeben und sind online über das &quot;Digitale Geoportal der Geschichte \n      der Orthodoxen in &Ouml;sterreich&quot; für interessierte InternetnutzerInnen frei \n      abrufbar. Die Daten umfassen insgesamt 282 Personen und 256 Orte. Solch eine \n      Forschung ist für Wien unter anderem deshalb von großer Bedeutung, weil die \n      Spuren berühmter SerbInnen in Wien derzeit lediglich mit einigen wenigen \n      Gedenktafeln im &ouml;ffentlichen Raum dokumentiert sind. Mit Hilfe des Geoportals \n      k&ouml;nnen Stadtspazierg&auml;nge gezielt geplant und interessante, historische \n      Pl&auml;tze aufgesucht werden.\n    </p>\n    <table className=\"project-meta\">\n      <tbody>\n        <tr>\n          <td>Laufzeit des Projekts:</td>\n          <td>1. J&auml;nner 2018-30. Juni 2019</td>\n        </tr>\n\n        <tr>\n          <td>Gef&ouml;rdert von:</td>\n          <td>Magistratsabteilung (MA) 7 –Kultur, Wissenschafts-und Forschungsf&ouml;rderung der Stadt Wien für 2017</td>            \n        </tr>\n\n        <tr>\n          <td>Siehe dazu im Detail:</td>\n          <td>\n            <a href=\"https://orthodoxes-europa.at/projekte/Digitales-Geoportal-der-Geschichte-der-SerbInnen-in-Wien\">\n              Digitales Geoportal der Geschichte der SerbInnen in Wien\n            </a>\n          </td>\n        </tr>\n    </tbody>\n    </table>\n  </>\n\nconst DESCRIPTION_ENGLISH = \n  <>\n    <p className=\"project-description\">\n      In this project research on the biographies of the Orthodox Viennese Serbs from 1741 until 1918, \n      i.e. significant personalities of the political, social, economic, scientific and cultural life of \n      the time, was conducted in Viennese archives as well as on their places of residence and of work \n      in Vienna. The biographical data and the respective localisations of places of residence and of \n      work were embedded into an OpenAtlas database and may be accessed freely online by the general \n      public via the &quot;Digital Geoportal of the History of the Orthodox in Austria&quot;. The data \n      comprises 282 personalities and 256 places. Such research is of great importance for Vienna, amongst \n      others, because the traces of famous Serbs in Vienna are currently only documented with a few \n      memorial plaques in public space. Based on the Geoportal specific city walks can be planned and \n      interesting, historic places can be visited.  \n    </p>\n    <table className=\"project-meta\">\n      <tbody>\n        <tr>\n          <td>Duration of the Project:</td>\n          <td>1 January 2018-30 June 2019</td>\n        </tr>\n\n        <tr>\n          <td>Sponsored by:</td>\n          <td>Magistratsabteilung (MA) 7 –Kultur, Wissenschafts-und Forschungsförderung der Stadt Wien für 2017</td> \n        </tr>\n\n        <tr>\n          <td>Cf. in detail:</td>\n          <td>\n            <a href=\"https://orthodoxes-europa.at/projekte/Digitales-Geoportal-der-Geschichte-der-SerbInnen-in-Wien\">\n              Digitales Geoportal der Geschichte der SerbInnen in Wien\n            </a>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </>\n\nconst PAGE_TITLE = {\n  'de': 'SerbInnen in Wien 1741-1918',\n  'en': 'Serbs in Vienna 1741-1918'\n}\n\nconst TEXT_TITLE = {\n  'de': 'Ein digitales Geoportal der Geschichte der SerbInnen in Wien (1741-1918)',\n  'en': 'A Digital Geoportal of the History of the Serbs in Vienna (1741-1918)'\n}\n\nconst DESCRIPTION = {\n  'de': DESCRIPTION_GERMAN,\n  'en': DESCRIPTION_ENGLISH\n}\n\nconst SerbsInVienna = props => {\n\n  const lang = useLang();\n\n  const content = \n    <div className=\"fill-height\">\n      <div className=\"page-container fill-height\">\n        <h1>{TEXT_TITLE[lang]}</h1>\n        <div>\n          {DESCRIPTION[lang]}\n        </div>\n      </div>\n      <footer>\n        <img src=\"images/wienkultur_logo_RGB.png\" alt=\"Logo Wien Kultur\"></img>\n      </footer>\n    </div>\n\n  return (\n    <PageWithMenu\n      backButton  \n      current=\"SerbsInVienna\"\n      title={PAGE_TITLE[lang]}\n      {...props}>\n\n      {content}\n\n    </PageWithMenu>\n  )\n\n}\n\nexport default SerbsInVienna;","import React from 'react';\nimport PageWithMenu from '../PageWithMenu';\nimport { useLang } from '../i18n';\n\nconst DESCRIPTION_GERMAN = \n  <>\n    <p className=\"project-description\">\n      In diesem Projekt beschäftigen wir uns mit dem schweren Los der Zivilbevölkerung im \n      Ersten Weltkrieg (1914-1918) und hier im besonderen mit der östlichen Front \n      Österreich-Ungarns in diesem weltumspannenden Konflikt. Mit dem Ausbruch des Ersten \n      Weltkriegs am 28. Juli 1914 gelang es der Armee des Zarenreichs Russland zunächst, in \n      der Bukowina und in Ostgalizien (d. h. im heutigen Polen, Rumänien und der Ukraine) tief auf\n      das Staatsgebiet Österreich-Ungarns einzudringen. Dies hatte zur Folge, dass die\n      dortige – zu einem beträchtlichen Teil orthodoxe – Bevölkerung floh/fliehen musste und \n      in der Folge in andere Teile der Monarchie evakuiert werden musste. Daraufhin begann die \n      Statthalterei von Niederösterreich (damals das Erzherzogtum Österreich unter der Enns), \n      zivile Flüchtlingslager – unter anderem in Oberhollabrunn – für die eigenen Staatsbürger \n      einzurichten.\n    </p>\n    <p className=\"project-description\">\n      Unser Forschungsprojekt verwendet unveröffentlichte Bestände des Archivs der griechisch-orthodoxen \n      Kirchengemeinde zur Heiligen Dreifaltigkeit in der Metropolis von Austria (1010 Wien). \n      Basierend auf 343 Totenbeschaubefunden zu den orthodoxen Flüchtlingen im Flüchtlingslager \n      Oberhollabrunn können wir nachvollziehen, wo die Verstorbenen geboren wurden, welchen Beruf sie \n      hatten, aus welchen Orten sie geflohen sind etc. Dadurch entsteht ein Bild ihrer Flucht und ihres \n      Schicksals vor unseren Augen. Dieses holen wir mit digitalen Karten und datenbankbasierten \n      Suchfunktionen aus der Vergessenheit und machen es der interessierten Öffentlichkeit zugänglich.\n    </p>\n    <p className=\"project-description\">\n      Wir danken dem Zukunftsfonds der Republik Österreich für die finanzielle Projektförderung,\n      der griechisch-orthodoxen Metropolis von Austria für die infrastrukturelle und \n      wissenschaftliche Unterstützung, dem Austrian Institute of Technology (AIT) für die technische \n      Zusammenarbeit und dem Stadtarchiv Hollabrunn für die archivische Beratung.\n    </p>\n    <table className=\"project-meta\">\n      <tbody>\n        <tr>\n          <td>Laufzeit des Projekts:</td>\n          <td>1. Juli 2020 bis 1. August 2021</td>\n        </tr>\n\n        <tr>\n          <td>Gefördert von:</td>\n          <td>Zukunftsfonds der Republik Österreich</td>            \n        </tr>\n\n        <tr>\n          <td>Siehe dazu im Detail:</td>\n          <td>\n            <a href=\"https://orthodoxes-europa.at/projekte/Flucht-Gefangenschaft-Neubeginn-und-Widerstand\">\n              Flucht, Gefangenschaft, Neubeginn und Widerstand\n            </a>\n          </td>\n        </tr>\n    </tbody>\n    </table>\n  </>\n\nconst DESCRIPTION_ENGLISH = \n  <>\n    <p className=\"project-description\">\n      In this project we deal with the severe fate of the civilian population in the First \n      World War (1914-1918) and in particular with the Eastern Front of Austria-Hungary in \n      this worldwide conflict. With the outbreak of the First World War on 28 July 1914, \n      the army of the Tsardom of Russia first succeeded in penetrating deeply into the \n      territory of Austria-Hungary in Bukovina and in Eastern Galicia (i.e. in today's \n      Poland, Romania and Ukraine). As a result, the local population – to a considerable \n      extent Orthodox – fled/had to flee and had to be evacuated to other parts of the \n      Austro-Hungarian Monarchy. As a result, the governorship of Lower Austria (then the \n      Archduchy of Austria below the River Enns) began to set up civilian refugee \n      camps – amongst others in Oberhollabrunn – for their own citizens.\n    </p>\n    <p className=\"project-description\">\n      Our research project uses unpublished holdings of the archive of the Greek-Orthodox \n      parish of the Holy Trinity in the Metropolis of Austria (1010 Vienna). Based on 343 \n      post mortem examinations of the Orthodox refugees in the refugee camp Oberhollabrunn, \n      we can trace where the deceased were born, what profession they had, from which places \n      they fled, etc. This creates a vivid picture of their flight and their subsequent \n      fate before our eyes. By means of digital maps and database-related search \n      functions we bring this picture out of oblivion and make it accessible to the \n      interested public.  \n    </p>\n    <p className=\"project-description\">\n      We are grateful to the Future Fund of the Republic of Austria for the funding of the project, \n      the Greek-Orthodox Metropolis of Austria for the infrastructural and scholarly support, \n      the Austrian Institute of Technology (AIT) for the technical cooperation and the Municipal \n      Archive Hollabrunn for the archival assistance.\n    </p>\n    <table className=\"project-meta\">\n      <tbody>\n        <tr>\n          <td>Duration of the Project:</td>\n          <td>1 July 2020-1 August 2021</td>\n        </tr>\n\n        <tr>\n          <td>Sponsored by:</td>\n          <td>Zukunftsfonds der Republik Österreich</td> \n        </tr>\n\n        <tr>\n          <td>Cf. in detail:</td>\n          <td>\n            <a href=\"https://orthodoxes-europa.at/projekte/Flucht-Gefangenschaft-Neubeginn-und-Widerstand\">\n              Flucht, Gefangenschaft, Neubeginn und Widerstand\n            </a>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </>\n\nconst PAGE_TITLE = {\n  'de': 'Auf der Flucht in der Monarchie',\n  'en': 'On the Run in the Austro-Hungarian Monarchy'\n}\n\nconst TEXT_TITLE = {\n  'de': 'Auf der Flucht in der Monarchie – das Schicksal der orthodoxen Flüchtlinge im Lager Oberhollabrunn (1914-1918)',\n  'en': 'On the Run in the Austro-Hungarian Monarchy – the Fate of Orthodox Refugees in the Camp Oberhollabrunn (1914-1918)'\n}\n\nconst DESCRIPTION = {\n  'de': DESCRIPTION_GERMAN,\n  'en': DESCRIPTION_ENGLISH\n}\n\nconst CampOberhollabrunn = props => {\n\n  const lang = useLang();\n\n  const content = \n    <div className=\"fill-height\">\n      <div className=\"page-container fill-height\">\n        <h1>{TEXT_TITLE[lang]}</h1>\n        <div>\n          {DESCRIPTION[lang]}\n        </div>\n      </div>\n      <footer>\n        <img src=\"images/zf_logo.png\" alt=\"Logo Zukunftsfonds der Republik Österreich\"></img>\n      </footer>\n    </div>\n\n  return (\n    <PageWithMenu\n      backButton\n      current=\"CampOberhollabrunn\"\n      title={PAGE_TITLE[lang]}\n      {...props}>\n      {content}\n    </PageWithMenu>\n  )\n\n}\n\nexport default CampOberhollabrunn;","import React from 'react';\nimport { Button, Icon } from 'react-onsenui';\nimport { useI18N, useBilingual } from '../i18n';\nimport { SPLASH_MESSAGE } from './SplashPageMobile';\nimport PageWithMenuDesktop from '../PageWithMenuDesktop';\n\nimport SearchPageDeskop from '../search/SearchPageDesktop';\nimport OverviewMap from '../map/OverviewMap';\nimport SerbsInVienna from '../projects/SerbsInVienna';\nimport CampOberhollabrunn from '../projects/CampOberhollabrunn';\n\nconst SplashPageDesktop = props => {\n\n  const i18n = useI18N();\n\n  const getTranslation = useBilingual();\n\n  const goTo = component => () =>\n    props.navigator.pushPage({ component });\n\n  return (\n    <PageWithMenuDesktop \n      className=\"splashpage\"\n      current=\"SplashPage\"\n      navigator={props.navigator}>\n      \n      <div className=\"splash-page-container\">\n        <div className=\"splash-image-container\">\n          <img className=\"splash-image\" src=\"images/OrthodoxyInEurope.png\" alt=\"Orthodoxy in Europe - Map\" />\n\n          <div className=\"splash-message\">\n            <h1>\n              {i18n('Digital Geoportal of the History of the Orthodox in Austria')}\n            </h1>\n            <p>\n              {getTranslation(SPLASH_MESSAGE)}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"buttons\">\n          <Button onClick={goTo(OverviewMap)}>\n            <Icon icon=\"md-globe\" />\n            <label>{i18n('Map')}</label>\n          </Button>\n          <Button onClick={goTo(SearchPageDeskop)}>\n            <Icon icon=\"md-search\" />\n            <label>{i18n('Search')}</label>\n          </Button>\n        </div>\n\n        <div className=\"content\">\n          <div className=\"projects\">\n            <h2>{i18n('Projects')}</h2>\n            <ol>\n              <li>\n                <Button modifier=\"large--quiet\" onClick={goTo(SerbsInVienna)}>\n                  {i18n('Serbs in Vienna 1741-1918')}\n                </Button>\n              </li>\n              \n              <li>\n                <Button modifier=\"large--quiet\" onClick={goTo(CampOberhollabrunn)}>\n                  {i18n('Orthodox Refugees in Hollabrunn 1914-1918')}\n                </Button>\n              </li>\n            </ol>\n          </div>\n        </div>\n\n        <footer>\n          <strong>{i18n('Imprint')}</strong><br/>\n          Digitales Geoportal der Geschichte der Orthodoxen in Österreich<br/>\n          Vertreten durch:<br/>\n          Priv.-Doz. Mag. Dr. Mihailo Popović, Projektleiter<br/>\n          Kiningergasse 12/2/7<br/>\n          1120 Wien<br/>\n          Österreich<br/>\n          <a href=\"mailto:mihailop@hotmail.com\">mihailop@hotmail.com</a>\n        </footer>\n      </div>\n    </PageWithMenuDesktop>\n  )\n\n}\n\nexport default SplashPageDesktop;","import React from 'react';\nimport PageWithMenu from '../PageWithMenu';\nimport { useLang } from '../i18n';\n\nimport './Help.scss';\n\nconst de = \n  <>\n    <p>\n      Sie können die Datenbank entweder mit Hilfe \n      der <span>Suchfunktion</span> oder der <span>Überblickskarte</span> durchsuchen.\n    </p>\n\n    <p>\n      Tippen sie das Zurück-Icon oder die Rücktaste ihres \n      Gerätes um zur vorherigen Seite zu zurückzukehren. \n    </p>\n\n    <p>\n      Benutzen sie das Hauptmenü um zur Startseite, zur Suche,\n      oder zu den Projektinformations-Seiten zu navigieren, oder\n      um die Spracheinstellung zwischen Englisch und Deutsch \n      umzuschalten.\n    </p>\n\n    <h1>App-Information</h1>\n    <p>\n      Diese Anwendung nutzt u.A. die folgenden Open Source Softwarebibliotheken und Datenquellen: \n    </p>\n    <ul>\n      <li><a href=\"https://leafletjs.com/\" target=\"_blank\" rel=\"noreferrer\">Leaflet</a></li>\n      <li>\n        Kartendaten von <a href=\"https://developers.arcgis.com/\" target=\"_blank\" rel=\"noreferrer\">ESRI ArcGIS online</a>. \n        Source: Esri, Maxar, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community.\n      </li>\n    </ul>\n  </>\n\nconst en = \n  <>\n    <p>\n      You can explore the database either through \n      the <span>Search</span> function, or the <span>Overview Map</span>.\n    </p>\n\n    <p>\n      Tap the Back icon or your device back button to return to\n      the previous page. \n    </p>\n\n    <p>\n      Use the main menu to go back to the start page, to the search,\n      or the project information pages, or to toggle the language \n      setting between English and German.\n    </p>\n\n    <h1>App Information</h1>\n    <p>\n      This application makes use of the following open source software libraries and \n      data sources:\n    </p>\n    <ul>\n      <li><a href=\"https://leafletjs.com/\" target=\"_blank\" rel=\"noreferrer\">Leaflet</a></li>\n      <li>\n        Map data from <a href=\"https://developers.arcgis.com/\" target=\"_blank\" rel=\"noreferrer\">ESRI ArcGIS online</a>. \n        Source: Esri, Maxar, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community.\n      </li>\n    </ul>\n  </>\n\nconst TITLE = {\n  'de': 'Hilfe',\n  'en': 'Help'\n}\n\nconst CONTENT = { de, en }\n\nconst Help = props => {\n\n  const lang = useLang();\n\n  return (\n    <PageWithMenu\n      backButton\n      className=\"app-help\"\n      title={TITLE[lang]}\n      current=\"Help\"\n      {...props}>\n        \n      <div className=\"page-container\">\n        {CONTENT[lang]}\n      </div>\n\n    </PageWithMenu>\n  )\n\n}\n\nexport default Help;","import axios from 'axios';\nimport bbox from '@turf/bbox';\nimport distance from '@turf/distance';\nimport centroid from '@turf/centroid';\n\nconst getBounds = geojson => {\n  const corners = bbox(geojson);\n  return [\n    [ corners[1], corners[0] ],\n    [ corners[3], corners[2] ]\n  ];\n}\n\nconst buildWaypointFeatures = (waypoints, store) => ({\n  type: 'FeatureCollection',\n  features: waypoints.map(waypoint => {\n    const record = store.findById(waypoint.id);\n    const latlon = centroid(record.geometry);\n    const hasValidGeometry = latlon.geometry.coordinates.every(coord => !isNaN(coord));\n\n    return hasValidGeometry && record.description && {\n      type: 'Feature',\n      properties: {\n        title: record.properties.title.replace('Oberhollabrunn, Flüchtlingslager,', '').trim(),\n        images: record.depictions,\n        description: record.description.map(d => d.value).join('\\n\\n'),\n        viewpoint: waypoint.lonlat.slice().reverse()\n      },\n      geometry: record.geometry\n    }\n  }).filter(f => f)\n})\n\nclass Tour {\n\n  load(tour, store) {\n    return Promise.all([\n      axios.get(`tours/${tour}-track.json`),\n      axios.get(`tours/${tour}-waypoints.json`)\n    ]).then(results => {\n      this.track = results[0].data;\n      \n      // Allow GeoJSON feature collection or DB ID list\n      this.waypoints = results[1].data.type === 'FeatureCollection' ?\n        results[1].data : buildWaypointFeatures(results[1].data, store);\n\n      this.bounds = getBounds(this.track);\n    });\n  }\n\n  getProp(name) {\n    return this.track.features[0].properties[name];\n  }\n\n  getDescription(language) {\n    return language === 'en' ?\n      this.getProp('description_en') : this.getProp('description_de');\n  }\n\n  get duration() {\n    return this.getProp('duration_minutes');\n  }\n\n  get image() {\n    return this.getProp('image');\n  }\n\n  get title() {\n    return this.getProp('title');\n  }\n\n  getNearestWaypoint = pos => {\n    if (pos) {\n      const currentPos = {\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'Point',\n          coordinates: [ pos.coords.longitude, pos.coords.latitude ]\n        }\n      };\n\n      const distances = this.waypoints.features.map(f => distance(currentPos, f));\n      const minDistance = Math.min.apply(null, distances);\n\n      return this.waypoints.features[distances.indexOf(minDistance)];\n    }\n  }\n\n}\n\n/** Instantiate a tour object, return the promise, and map result to the tour itself **/\nexport const loadTour = (name, store) => {\n  const tour = new Tour();\n  return tour.load(name, store).then(() => tour);\n}","import React, { useState } from 'react';\nimport SideMenu from './SideMenu';\nimport { \n  BackButton,\n  Icon, \n  Page, \n  Splitter, \n  SplitterContent, \n  SplitterSide, \n  Toolbar, \n  ToolbarButton \n} from 'react-onsenui';\n\nconst PageWithMenuMobile = props => {\n\n  const [ isMenuOpen, setMenuOpen ] = useState(false);\n\n  const onBackButton = () => {\n    props.navigator.popPage();\n  }\n\n  return (\n    <Page className={props.className}>\n      <Splitter>\n        <SplitterContent>\n          <Page \n            onDeviceBackButton={onBackButton}\n            renderToolbar={() => \n              <Toolbar>\n                { props.backButton &&\n                  <BackButton />\n                }\n                <div className=\"center\">\n                  { props.title }\n                </div>\n                <div className=\"right\">\n                  <ToolbarButton onClick={() => setMenuOpen(true)}>\n                    <Icon icon=\"md-menu\" />\n                  </ToolbarButton>\n                </div>\n              </Toolbar>\n            }>\n\n            { props.children }\n\n          </Page>\n        </SplitterContent>\n        <SplitterSide\n          animation=\"overlay\"\n          mode=\"collapse\"\n          side=\"right\"\n          collapse={true}\n          width=\"300px\"\n          isOpen={isMenuOpen}\n          onClose={() => setMenuOpen(false)}>\n\n          <SideMenu \n            navigator={props.navigator} \n            onClose={() => setMenuOpen(false)} />\n\n        </SplitterSide>\n      </Splitter>\n    </Page>\n  )\n\n}\n\nexport default PageWithMenuMobile;","import React from 'react';\nimport { CircleMarker, LayerGroup } from 'react-leaflet';\n\nconst OUTER_STYLE = {\n  radius: 32,\n  weight: 1,\n  color: '#739cff',\n  fillColor: '#004aff',\n  fillOpacity: 0.3\n}\n\nconst INNER_STYLE = {\n  radius: 5,\n  stroke: false,\n  fillOpacity: 1,\n  fillColor: '#004aff'\n}\n\nconst MyPosition = props => {\n\n  const { latitude, longitude } = props.pos.coords;\n\n  const center = [ latitude, longitude ];\n\n  return (\n    <LayerGroup>\n      <CircleMarker \n        {...{ ...OUTER_STYLE, center }} />\n\n      <CircleMarker\n        {...{ ...INNER_STYLE, center }} />\n    </LayerGroup>\n  )\n\n}\n\nexport default MyPosition;","import React from 'react';\nimport { CircleMarker, GeoJSON, LayerGroup, Pane } from 'react-leaflet';\n\nconst OUTER_STYLE = {\n  radius: 12,\n  weight: 2,\n  color: '#000',\n  fillColor: '#fff',\n  fillOpacity: 1\n}\n\nconst INNER_STYLE = {\n  radius: 4,\n  stroke: false,\n  fillOpacity: 1,\n  fillColor: '#000'\n}\n\nconst NextStop = props => {\n\n  const { viewpoint } = props.waypoint.properties;\n\n  return (\n    <>\n      <Pane style={{ zIndex: 99999 }}>\n        <LayerGroup>\n          <CircleMarker \n            {...{ ...OUTER_STYLE, center: viewpoint }} />\n\n          <CircleMarker\n            {...{ ...INNER_STYLE, center: viewpoint }} />\n        </LayerGroup>\n      </Pane>\n\n      <Pane style={{ zIndex: 99998 }}>\n        <GeoJSON key={JSON.stringify(props.waypoint.geometry.coordinates)} data={props.waypoint} />\n      </Pane>\n    </>\n  )\n\n}\n\nexport default NextStop;","import React, { useState, useEffect, useRef } from 'react';\nimport { Button, Icon } from 'react-onsenui';\nimport distance from '@turf/distance';\nimport { CSSTransition } from 'react-transition-group';\nimport { useI18N, useBilingual } from '../../i18n';\nimport ImageGroup from '../../ImageGroup';\n\nimport './InfoPanel.scss';\n\nconst InfoPanel = props => {\n\n  const main = useRef();\n\n  const [ expanded, setExpanded ] = useState(false);\n\n  const i18n = useI18N();\n\n  const getTranslation = useBilingual();\n  \n  // turf.js needs GeoJSON feature\n  const currentPos = props.pos ? {\n    type: 'Feature',\n    properties: {},\n    geometry: {\n      type: 'Point',\n      coordinates: [ props.pos.coords.longitude, props.pos.coords.latitude ]\n    }\n  } : null;\n\n  const next = {\n    type: 'Feature',\n    properties: {},\n    geometry: {\n      type: 'Point',\n      coordinates: props.waypoint.properties.viewpoint\n    }\n  }\n\n  const dist = currentPos ? Math.round(distance(currentPos, next) * 1000) : null;\n  \n  const proximity = props.useGPS ? (dist !== null && dist < 25 ? 'ARRIVED' : 'FAR') : 'NO-GPS';\n\n  useEffect(() => {\n    if (main.current)\n      main.current.scrollTop = 0;\n  }, [ props.waypoint ])\n\n  useEffect(() => {\n    // If proximity changes to 'ARRIVED', buzz & expand panel\n    if (proximity === 'ARRIVED') {\n      window.navigator.vibrate(200);\n      setExpanded(true);\n    }\n  }, [ proximity ])\n\n  const onNextWaypoint = () => {\n    if (props.useGPS)\n      setExpanded(false);\n    \n      props.onNextWaypoint();\n  }\n\n  const onPreviousWaypoint = () => {\n    if (props.useGPS)\n      setExpanded(false);\n    \n      props.onPreviousWaypoint();\n  }\n\n  const headerImage = props.waypoint.properties.images && \n    (props.waypoint.properties.images[0].url.startsWith('http') ? \n      props.waypoint.properties.images[0].url :\n        `tours/images/${props.waypoint.properties.images[0].url}`);\n\n  const toParagraphs = description =>\n    description.split(/(\\r|\\n)+/g).filter(para => para.trim());\n\n  return (\n    <CSSTransition in={expanded} timeout={200}>\n      <div className=\"tour-map-infopanel\">\n        <div className={`next-stop ${proximity}`}>\n          {proximity === 'FAR' &&\n            <h1>\n              { \n                props.isStart ? i18n('First Stop') : (\n                  props.isEnd ? i18n('Last Stop') : i18n('Next Stop')\n                )\n              }\n            </h1>\n          }\n\n          {proximity === 'ARRIVED' &&\n            <h1>{i18n('You have arrived!')}</h1> }\n\n          {proximity === 'NO-GPS' &&\n            <h1>\n              { \n                props.isStart ? i18n('First Stop') : (\n                  props.isEnd ? i18n('Last Stop') : `${i18n('Stop')} ${props.waypointIdx + 1}`\n                )\n              }\n            </h1>\n          }\n\n          <h2>\n            {proximity === 'FAR' &&\n              <span className=\"distance\"><Icon icon=\"md-walk\" /> {dist || '-'}m </span> }\n\n            {props.waypoint.properties.title}\n          </h2>\n\n          <button \n            className=\"expand\"\n            onClick={() => setExpanded(!expanded)}>\n            <Icon icon=\"md-chevron-right\" /> \n          </button>\n        </div>\n        \n        <main ref={main}>\n          <div \n            className=\"waypoint-image\"\n            style={{ backgroundImage: `url('${headerImage}')` }}>\n          </div>\n          <div className=\"waypoint-description\">\n            {toParagraphs(getTranslation(props.waypoint.properties.description)).map((p, idx) => \n              <p key={idx}>{p}</p>\n            )}\n            \n            <ImageGroup depictions={props.waypoint.properties.images} />\n\n            <div className=\"buttons\">\n              {props.isEnd ?\n                <>\n                  <p><strong>{i18n('You have reached the end of our tour.')}</strong></p>\n                  <Button\n                    className=\"go-back\" \n                    onClick={props.onReturn}>\n                    {i18n('Back')}\n                  </Button>\n                </> :\n\n                <Button \n                  className=\"next-waypoint\" \n                  onClick={onNextWaypoint}>\n\n                  <Icon icon=\"md-walk\" /> {i18n('Continue to Next Stop')}\n                </Button>\n              }\n\n              {!props.isStart &&\n                <button \n                  className=\"prev-waypoint\"\n                  onClick={onPreviousWaypoint}>{i18n('Back to previous stop')}</button>\n              }\n            </div>\n\n            <div className=\"shade-gradient\" />\n          </div>\n        </main>\n      </div>\n    </CSSTransition>\n  ) \n\n}\n\nexport default InfoPanel;","import React, { useEffect, useRef, useState } from 'react';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport PageWithMenu from '../../PageWithMenu';\nimport MyPosition from '../map/MyPosition';\nimport NextStop from '../map/NextStop';\nimport InfoPanel from './InfoPanel';\n\nimport './WaypointPage.scss';\n\nconst PATH_STYLE = {\n  color: '#000',\n  dashArray: '6 6'\n}\n\nconst WaypointPage = props => {\n\n  const [ waypoint, setWaypoint ] = useState(props.tour.waypoints.features[0]);\n\n  const [ pos, setPos ] = useState();\n\n  const mapRef = useRef();\n\n  const currentIdx = props.tour.waypoints.features.indexOf(waypoint);\n\n  const fitBounds = () => {\n    if (mapRef.current) {\n      const map = mapRef.current.leafletElement;\n\n      let bounds = null;\n\n      if (props.useGPS && pos) {\n        // When using GPS, fit map to waypoint + current location\n        const lons = [ pos.coords.longitude, waypoint.properties.viewpoint[1] ];\n        const lats = [ pos.coords.latitude, waypoint.properties.viewpoint[0] ];\n\n        bounds = [\n          [ Math.min(...lats), Math.min(...lons) ],\n          [ Math.max(...lats), Math.max(...lons) ]\n        ];\n      } else {\n        // When not using GPS, just fit to tour path\n        bounds = props.tour.bounds;\n      }\n\n      map.fitBounds(bounds, { \n        paddingTopLeft: [ 15, 15 ],\n        paddingBottomRight: [ 10, window.innerHeight  / 2 ]\n      });\n    }\n  }\n\n  useEffect(() => {\n    fitBounds();\n    \n    if (props.useGPS) {\n      const watchId = navigator.geolocation?.watchPosition(pos => {\n        setPos(pos);\n      }, null, { enableHighAccuracy: true });\n\n      return function cleanup() {\n        navigator.geolocation?.clearWatch(watchId);\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    fitBounds();\n  }, [ waypoint ]);\n\n  const onNextWaypoint = () => {\n    const nextIdx = Math.min(currentIdx + 1, props.tour.waypoints.features.length - 1);\n    setWaypoint(props.tour.waypoints.features[nextIdx]);\n  }\n\n  const onPrevWaypoint = () => {\n    const prevIdx = Math.max(0, currentIdx - 1);\n    setWaypoint(props.tour.waypoints.features[prevIdx]);\n  }\n\n  const onReturn = () =>\n    props.navigator.popPage();\n\n  return (\n    <PageWithMenu \n      backButton\n      className=\"tour-gps\"\n      title={props.tour.title}\n      navigator={props.navigator}>\n\n      <Map \n        ref={mapRef}\n        zoomControl={false}\n        attributionControl={false}>\n        <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n        <GeoJSON { ...{...PATH_STYLE, data: props.tour.track }} />\n        \n        { pos && <MyPosition pos={pos} /> }\n\n        <NextStop waypoint={waypoint} />\n      </Map>\n\n      <InfoPanel \n        tour={props.tour} \n        useGPS={props.useGPS}\n        waypoint={waypoint} \n        waypointIdx={currentIdx}\n        pos={pos} \n        isStart={currentIdx === 0}\n        isEnd={currentIdx === props.tour.waypoints.features.length - 1}\n        onNextWaypoint={onNextWaypoint}\n        onPreviousWaypoint={onPrevWaypoint}\n        onReturn={onReturn} />\n    </PageWithMenu>\n  )\n\n}\n\nexport default WaypointPage;","import React, { useState, useEffect, useRef } from 'react';\nimport { Button, Icon } from 'react-onsenui';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport { useI18N , useLang } from '../../i18n';\nimport { loadTour } from '../Tour';\nimport PageWithMenuMobile from '../../PageWithMenuMobile';\nimport WaypointPage from '../mobile/WaypointPage';\n\nimport './StartPage.scss';\n\nconst PATH_STYLE = {\n  color: '#000',\n  dashArray: '6 6'\n}\n\nconst TourStartPage = props => {\n\n  const i18n = useI18N();\n\n  const lang = useLang();\n\n  const mapRef = useRef();\n\n  const [ tour, setTour ] = useState();\n\n  useEffect(() => {\n    loadTour('oberhollabrunn', props.store).then(setTour);\n  }, []);\n\n  useEffect(() => {\n    if (mapRef.current && tour) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(tour.bounds, { padding: [ 15, 15 ]});\n    }\n  }, [ tour ]);\n\n  const onStartTour = (tour, useGPS) => () =>\n    props.navigator.pushPage({ \n      component: WaypointPage,\n      tour,\n      useGPS\n    });\n\n  return (\n    <PageWithMenuMobile\n      backButton\n      className=\"tour-startpage\"\n      title={i18n('GPS Walking Tours')}\n      {...props}>\n\n      { tour &&\n        <>\n          <div className=\"tour-start-header-image\">\n            <img src={tour.image} alt=\"GPS walk header decoration\" />\n            <div className=\"caption\">\n              <h1>{tour.title}</h1>\n              <h3 className=\"duration\">\n                <Icon icon=\"md-time\" /> ca. {tour.duration} {i18n('Minutes')}\n              </h3>\n            </div>\n          </div>\n\n          <div className=\"tour-description\" dangerouslySetInnerHTML={{\n            __html: tour.getDescription(lang)\n          }} />\n\n          <div className=\"tour-overview-map\">\n            <Map \n              ref={mapRef}\n              zoomControl={false}\n              attributionControl={false}\n              style={{height:'200px'}}>\n              <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n              <GeoJSON data={tour.track} {...PATH_STYLE} />\n            </Map>\n            \n            <div className=\"clicktrap\" />\n          </div>\n\n          <div className=\"start-buttons\">\n            <Button onClick={onStartTour(tour, true)}>\n              <Icon icon=\"md-gps-dot\" /> <label>{i18n('Start the tour')}</label>\n            </Button>\n\n            <Button onClick={onStartTour(tour, false)} modifier=\"outline\" className=\"outline\">\n              <Icon icon=\"md-gps-off\" /> <label>{i18n('View tour without GPS')}</label>\n            </Button>\n          </div>\n        </>\n      }\n    </PageWithMenuMobile>\n  )\n\n}\n\nexport default TourStartPage;","import React, { useEffect, useRef, useState } from 'react';\nimport { Button, Icon } from 'react-onsenui';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport NextStop from '../map/NextStop';\nimport { useI18N, useBilingual } from '../../i18n';\nimport PageWithMenuDesktop from '../../PageWithMenuDesktop';\nimport ImageGroup from '../../ImageGroup';\n\nimport './WaypointPage.scss';\n\nconst PATH_STYLE = {\n  color: '#000',\n  dashArray: '6 6'\n}\n\nconst WaypointPage = props => {\n\n  const [ waypoint, setWaypoint ] = useState(props.tour.waypoints.features[0]);\n  \n  const i18n = useI18N();\n\n  const mapRef = useRef();\n\n  const getTranslation = useBilingual();\n\n  useEffect(() => {\n    if (mapRef.current && props.tour) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(props.tour.bounds, { padding: [ 15, 15 ]});\n    }\n  }, [ props.tour ]);\n\n  const currentIdx = props.tour.waypoints.features.indexOf(waypoint);\n  const isStart = currentIdx === 0;\n  const isEnd = currentIdx === props.tour.waypoints.features.length - 1;\n\n  const onNextWaypoint = () => {\n    const nextIdx = Math.min(currentIdx + 1, props.tour.waypoints.features.length - 1);\n    setWaypoint(props.tour.waypoints.features[nextIdx]);\n  }\n\n  const onPrevWaypoint = () => {\n    const prevIdx = Math.max(0, currentIdx - 1);\n    setWaypoint(props.tour.waypoints.features[prevIdx]);\n  }\n\n  return (\n    <PageWithMenuDesktop\n      className=\"tour-desktop\"\n      title={i18n('Walking Tour')}\n      {...props}>\n\n      <div className=\"map-container\">\n        <Map \n          ref={mapRef}\n          zoomControl={false}\n          attributionControl={false}>\n          <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n          <GeoJSON { ...{...PATH_STYLE, data: props.tour.track }} /> \n          <NextStop waypoint={waypoint} />\n        </Map>\n\n        <div className=\"buttons map\">\n          {!isStart &&\n            <span>\n              <Button className=\"prev-stop\" onClick={onPrevWaypoint}>\n                <Icon icon=\"md-chevron-left\" />\n              </Button>\n            </span>\n          }\n\n          {!isEnd &&\n            <span>          \n              <Button className=\"next-stop\" onClick={onNextWaypoint}>\n                <Icon icon=\"md-chevron-right\" />\n              </Button>\n            </span>\n          }\n        </div>\n      </div>\n\n      <div className=\"waypoint-description\">\n        <h1>\n          { \n            isStart ? i18n('First Stop') : (\n              isEnd ? i18n('Last Stop') : `${i18n('Stop')} ${currentIdx + 1}`\n            )\n          }\n        </h1>\n\n        <h2>{waypoint.properties.title}</h2>\n\n        <p>\n          {getTranslation(waypoint.properties.description).replace('\\n', '\\n\\n')}\n        </p>\n\n        <ImageGroup depictions={waypoint.properties.images} />\n\n        <div className=\"buttons\">\n          {isEnd ?\n            <>\n              <p><strong>{i18n('You have reached the end of our tour.')}</strong></p>\n            </> :\n\n            <Button \n              className=\"next-waypoint\" \n              onClick={onNextWaypoint}>\n\n              <Icon icon=\"md-walk\" /> {i18n('Continue to Next Stop')}\n            </Button>\n          }\n\n          {!isStart &&\n            <button \n              className=\"prev-waypoint\"\n              onClick={onPrevWaypoint}>{i18n('Back to previous stop')}</button>\n          }\n        </div>\n      </div>\n\n    </PageWithMenuDesktop>\n  )\n\n}\n\nexport default WaypointPage;","import React, { useEffect, useRef, useState } from 'react';\nimport { GeoJSON, Map, TileLayer } from 'react-leaflet';\nimport { Button, Icon } from 'react-onsenui';\nimport { useI18N, useLang } from '../../i18n';\nimport { loadTour } from '../Tour';\nimport PageWithMenuDesktop from '../../PageWithMenuDesktop';\nimport WaypointPage from './WaypointPage';\n\nimport './StartPage.scss';\n\nconst PATH_STYLE = {\n  color: '#000',\n  dashArray: '6 6'\n}\n\nconst StartPage = props => {\n\n  const i18n = useI18N();\n\n  const language = useLang();\n\n  const mapRef = useRef();\n\n  const [ tour, setTour ] = useState();\n\n  useEffect(() => {\n    loadTour('oberhollabrunn', props.store).then(setTour);\n  }, []);\n\n  useEffect(() => {\n    if (mapRef.current && tour) {\n      const map = mapRef.current.leafletElement;\n      map.fitBounds(tour.bounds, { padding: [ 15, 15 ]});\n    }\n  }, [ tour ]);\n\n  const onStartTour = tour => () =>\n    props.navigator.pushPage({ component: WaypointPage, tour });\n\n  return (\n    <PageWithMenuDesktop\n      className=\"tour-startpage-desktop\"\n      title={i18n('Walking Tour')}\n      current=\"Tour\"\n      {...props}>\n\n      {tour &&\n        <>\n          <div className=\"tour-desktop-header\">\n            <div className=\"tour-image\">\n              <img src={tour.image} alt=\"GPS walk header decoration\" />\n            </div>\n\n            <div className=\"tour-overview-map\">\n              <Map \n                ref={mapRef}\n                zoomControl={false}\n                attributionControl={false}\n                style={{height:'350px'}}>\n                <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\n                <GeoJSON data={tour.track} {...PATH_STYLE} />\n              </Map>\n              <div className=\"clicktrap\" />\n            </div>\n          </div>\n\n          <div className=\"tour-description\" dangerouslySetInnerHTML={{\n            __html: tour.getDescription(language)\n          }} />\n\n          <div className=\"start-tour\">\n            <Button onClick={onStartTour(tour)}>\n              <Icon icon=\"md-walk\" /> <label>{i18n('Start the tour')}</label>\n            </Button>\n          </div>\n        </>\n      }\n    </PageWithMenuDesktop>\n  )\n\n}\n\nexport default StartPage;","import React from 'react';\nimport { Icon, List, ListHeader, ListItem, Page, Radio } from 'react-onsenui';\nimport { useRecoilState } from 'recoil';\nimport { languageState } from './store/State';\nimport { useI18N } from './i18n';\n\nimport SearchPageMobile from './search/SearchPageMobile';\nimport SearchPageDesktop from './search/SearchPageDesktop';\n\nimport SplashPageMobile from './splash/SplashPageMobile';\nimport SplashPageDesktop from './splash/SplashPageDesktop';\n\nimport SerbsInVienna from './projects/SerbsInVienna';\nimport CampOberhollabrunn from './projects/CampOberhollabrunn';\n\nimport Help from './help/Help';\n\nimport MobileTour from './tour/mobile/StartPage';\nimport DesktopTour from './tour/desktop/StartPage';\n\nimport './SideMenu.scss';\n\nconst SideMenu = props => {\n\n  const [ language, setLanguage ] = useRecoilState(languageState);\n\n  const i18n = useI18N();\n\n  const onChangeLanguage = lang => {\n    setLanguage(lang);\n    window.localStorage.setItem('zukunftsfonds.language', lang);\n  }\n\n  const goTo = (mobileComponent, optDesktopComponent) => () => {\n\n    const component = props.isDesktop && optDesktopComponent ? \n      optDesktopComponent : mobileComponent;\n\n    const { pages } = props.navigator;\n    const currentPage = pages.length > 0 ? pages[pages.length - 1].props.component : null;\n    if (component !== currentPage)\n      props.navigator.pushPage({ component });\n    else \n      props.onClose && props.onClose();\n  }\n\n  const setSelected = pageName =>\n    props.current === pageName ? 'selected' : null;\n\n  return (\n    <Page className=\"side-menu\">\n      <List>\n        <ListItem \n          onClick={goTo(SplashPageMobile, SplashPageDesktop)}>\n            <Icon icon=\"md-home\" />\n            <label className={setSelected('SplashPage')}>{i18n('Home')}</label>\n        </ListItem>\n\n        <ListItem onClick={goTo(SearchPageMobile, SearchPageDesktop)}>\n          <Icon icon=\"md-search\" />\n          <label className={setSelected('Search')}>{i18n('Search')}</label>\n        </ListItem>\n      </List>\n\n      <List>\n        <ListHeader>\n          <Icon icon=\"md-info-outline\" />\n          <label>{i18n('Information')}</label>\n        </ListHeader>\n\n        <ListItem onClick={goTo(Help)}>\n          <label className={setSelected('Help')}>{i18n('User Help & App Info')}</label>\n        </ListItem>  \n\n        <ListItem className=\"projects\">\n          <div>\n            <label>{i18n('Projects')}</label>\n            <ul>\n              <li \n                onClick={goTo(SerbsInVienna)}\n                className={setSelected('SerbsInVienna')}>\n                  \n                {i18n('Serbs in Vienna 1741-1918')}\n              </li>\n\n              <li \n                onClick={goTo(CampOberhollabrunn)}\n                className={setSelected('CampOberhollabrunn')}>\n                  \n                {i18n('Orthodox Refugees in Hollabrunn 1914-1918')}\n              </li>\n            </ul>\n          </div>\n        </ListItem>\n      </List>\n      \n      <List>\n        <ListHeader>\n          <Icon icon=\"md-walk\" />\n          <label>{i18n('Walking Tours')}</label>\n        </ListHeader>\n        \n        <ListItem onClick={goTo(MobileTour, DesktopTour)}>\n          <label className={setSelected('Tour')}>Oberhollabrunn</label>\n        </ListItem>\n      </List>\n\n      <List className=\"set-language\">\n        <ListHeader>\n          <Icon icon=\"md-translate\" />\n          <label>{i18n('Language')}</label>\n        </ListHeader>\n        \n        <ListItem>\n          <label className=\"left\">\n            <Radio \n              inputId='EN' \n              name='EN' \n              onChange={() => onChangeLanguage('en')} \n              checked={language === 'en'} />\n          </label>\n          \n          <label htmlFor='EN' className=\"center\">\n            English\n          </label>\n        </ListItem>\n        <ListItem>\n          <label className=\"left\">\n            <Radio \n              inputId='DE' \n              name='DE' \n              onChange={() => onChangeLanguage('de')} \n              checked={language === 'de'} />\n          </label>\n          \n          <label htmlFor='DE' className=\"center\">\n            Deutsch\n          </label>\n        </ListItem>\n      </List>\n    </Page>\n  )\n\n}\n\nexport default SideMenu;","import React from 'react';\nimport { Page } from 'react-onsenui';\nimport SideMenu from './SideMenu';\n\nconst PageWithMenuDesktop = props => {\n\n  if (props.isDesktop && props.title)\n    window.document.title = `Orthodox Europe | ${props.title}`;\n  else\n    window.document.title = \"Orthodox Europe\";\n  \n  return (\n    <Page className={`${props.className} desktop`}>\n      <header>\n        <h1>Orthodox Europe {props.title && <span className=\"subtitle\">{`| ${props.title}`}</span> }</h1>\n      </header>\n      <div className=\"page-wrapper\">\n        <aside>\n          <SideMenu \n            current={props.current}\n            isDesktop={true}\n            navigator={props.navigator} />\n        </aside>\n        <main>\n          { props.children }\n        </main>\n      </div>\n    </Page>\n  )\n\n}\n\nexport default PageWithMenuDesktop;","import React from 'react';\nimport PageWithMenuDesktop from './PageWithMenuDesktop';\nimport PageWithMenuMobile from './PageWithMenuMobile';\n\n/**\n * A hybrid page that applies desktop or mobile layout automatically\n * on the same content\n */\nconst PageWithenu = props => {\n\n  return props.isDesktop ?\n    <PageWithMenuDesktop\n      current={props.title}\n      {...props}>\n\n      {props.children}\n\n    </PageWithMenuDesktop> :\n\n    <PageWithMenuMobile\n      {...props}>\n      \n      {props.children}\n\n    </PageWithMenuMobile>\n\n}\n\nexport default PageWithenu;","import React from 'react';\nimport { Button, Icon } from 'react-onsenui';\nimport PageWithMenu from '../PageWithMenu';\nimport { useI18N, useBilingual } from '../i18n';\nimport OverviewMap from '../map/OverviewMap';\nimport SearchPageMobile from '../search/SearchPageMobile';\nimport SerbsInVienna from '../projects/SerbsInVienna';\nimport CampOberhollabrunn from '../projects/CampOberhollabrunn';\n\nimport './SplashPage.scss';\n\nexport const SPLASH_MESSAGE = \n  `Das \"Digitale Geoportal der Geschichte der Orthodoxen in Österreich\" hat das Ziel, die Geschichte,\n   den Glauben und die Kultur der orthodoxen Kirchen und von deren Gläubigen in Europa, mit einem Schwerpunkt \n   auf Österreich, mit Hilfe von wissenschaftlichen Projekten zu erforschen und einer breiten Öffentlichkeit \n   zugänglich zu machen. ------------ The \"Digital Geoportal of the History of the Orthodox in Austria\" has the \n   aim to research the history, faith and culture of the Orthodox churches and their believers in Europe, with \n   a special emphasis on Austria, based on scholarly projects and to popularise all of the aforesaid aspects in \n   the general public.`\n\nconst SplashPage = props => {\n\n  const i18n = useI18N();\n\n  const getTranslation = useBilingual();\n\n  const goTo = component => () =>\n    props.navigator.pushPage({ component });\n  \n  return (\n    <PageWithMenu \n      className=\"splashpage\"\n      title={i18n('Orthodox Europe')}\n      navigator={props.navigator}>\n\n      <div className=\"splash-page-container\">\n        <div className=\"splash-image-container\">\n          <img className=\"splash-image\" src=\"images/OrthodoxyInEurope.png\" alt=\"Orthodoxy in Europe - Map\" />\n        </div>\n\n        <div className=\"buttons\">\n          <Button onClick={goTo(OverviewMap)}>\n            <Icon icon=\"md-globe\" />\n            <label>{i18n('Map')}</label>\n          </Button>\n          <Button onClick={goTo(SearchPageMobile)}>\n            <Icon icon=\"md-search\" />\n            <label>{i18n('Search')}</label>\n          </Button>\n        </div>\n\n        <div className=\"splash-message\">\n          <h1>\n            {i18n('Digital Geoportal of the History of the Orthodox in Austria')}\n          </h1>\n          <p>\n            {getTranslation(SPLASH_MESSAGE)}\n          </p>\n        </div>\n\n        <div className=\"projects\">\n          <h2>{i18n('Projects')}</h2>\n          <ol>\n            <li>\n              <Button modifier=\"large--quiet\" onClick={goTo(SerbsInVienna)}>\n                {i18n('Serbs in Vienna 1741-1918')}\n              </Button>\n            </li>\n            \n            <li>\n              <Button modifier=\"large--quiet\" onClick={goTo(CampOberhollabrunn)}>\n                {i18n('Orthodox Refugees in Hollabrunn 1914-1918')}\n              </Button>\n            </li>\n          </ol>\n        </div>\n\n        <footer>\n          <strong>{i18n('Imprint')}</strong><br/>\n          Digitales Geoportal der Geschichte der Orthodoxen in Österreich<br/>\n          Vertreten durch:<br/>\n          Priv.-Doz. Mag. Dr. Mihailo Popović, Projektleiter<br/>\n          Kiningergasse 12/2/7<br/>\n          1120 Wien<br/>\n          Österreich<br/>\n          <a href=\"mailto:mihailop@hotmail.com\">mihailop@hotmail.com</a>\n        </footer>\n      </div>\n    </PageWithMenu>\n  )\n\n}\n\nexport default SplashPage;","import React, { useEffect, useRef } from 'react';\nimport { v4 as uuid } from 'uuid';\nimport { RecoilRoot } from 'recoil';\nimport { Navigator } from 'react-onsenui';\n\nimport SplashPageMobile from './splash/SplashPageMobile';\nimport SplashPageDesktop from './splash/SplashPageDesktop';\n\nimport 'onsenui/css/onsenui.css';\nimport 'onsenui/css/onsen-css-components.css';\n\nimport './App.scss';\n\nconst App = props => {\n\n  const nav = useRef();\n\n  const renderPage = (route, navigator) =>\n    React.createElement(route.component, { \n      ...route, \n      navigator, \n      key: props.key || uuid(), // Needs a key per definition and we want to re-render always\n      store: props.store,\n      isDesktop: props.isDesktop\n    });\n\n  // Pushes a state to the window history, so the back button doesn't\n  // close the app. It's actually just a dummy push (the state is never\n  // read). We'll rewire window.onpopstate instead to pop the navigator.\n  const onPostPush = evt => {\n    const { name } = evt.routes.pushedRoute.component;\n    window.history.pushState({ name }, '');\n  }\n\n  useEffect(() => {\n    window.onpopstate = () =>\n      nav.current && nav.current.popPage();\n  }, []);\n\n  const splashPage = props.isDesktop ? SplashPageDesktop : SplashPageMobile;\n\n  return (\n    <RecoilRoot>\n      <Navigator\n        ref={nav}\n        renderPage={renderPage}\n        initialRoute={{ component: splashPage, key: 'SplashPage' }} \n        onPostPush={onPostPush}\n        animation={props.isDesktop ? 'none' : 'slide'}\n        swipeable />\n    </RecoilRoot>\n  );\n\n}\n\nexport default App;\n","import React from 'react';\nimport { ProgressCircular } from 'react-onsenui';\n\nimport './LoadingScreen.scss';\n\nconst LoadingScreen = props => {\n\n  return(\n    <div className=\"loading-screen\">\n      <div className=\"loading-wrapper\">\n        <label>Loading</label>\n        <div>\n          <ProgressCircular indeterminate />\n        </div>\n      </div>\n    </div>\n  )\n\n}\n\nexport default LoadingScreen;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import axios from 'axios';\nimport * as JsSearch from 'js-search';\nimport centroid from '@turf/centroid';\n\nimport { getRelatedItems } from '../profiles/RelatedItems';\nimport { hasGeometry } from '../profiles/Utils';\nimport CRM from '../CRM';\n\n/**\n * Helper to compute the bounding box of all places in the dataset.\n */\nconst computeGeoBounds = places => {\n  const coords = places.reduce((allCoords, p) => {\n    const g = p.geometry;\n\n    // Support all the ways in which the data encodes point/poly coords\n    if (g.coordinates) {\n      if (Array.isArray(g.coordinates[0])) {\n        if (Array.isArray(g.coordinates[0][0]))\n          return allCoords.concat(...g.coordinates);\n        else \n          return allCoords.concat(g.coordinates);\n      } else {\n        // Single coordinate tuple\n        return allCoords.concat([ g.coordinates ]);\n      }\n    } else {\n      return allCoords;\n    }\n  }, []);\n\n  const lons = coords.map(t => t[0]);\n  const lats = coords.map(t => t[1]); \n\n  const minLon = Math.min(...lons);\n  const maxLon = Math.max(...lons);\n  const minLat = Math.min(...lats);\n  const maxLat = Math.max(...lats);\n\n  return [\n    [ minLat, minLon ],\n    [ maxLat, maxLon ]\n  ];\n}\n\n/**\n * Helper to compute the spatial 'life paths' of all actors, i.e. the \n * pairs of coordinates for actor 'begins_in' and 'ends_in' properties.\n * \n * Note that the computation will filter out places that don't have\n * coordinates.\n */\nconst computeLifePaths = (store, actors) => {\n  const paths = actors.reduce((paths, actor) => {\n    let { begins_in, ends_in } = getRelatedItems(actor, store).places; // .filter(p => hasGeometry(p));\n    \n    begins_in = begins_in.filter(p => hasGeometry(p));\n    ends_in = ends_in.filter(p => hasGeometry(p));\n\n    if (begins_in.length > 0 && ends_in.length > 0) {\n      return [ ...paths, {\n        actor, \n        begins: begins_in[0],\n        ends: ends_in[0]\n      }];\n    } else {\n      return paths;\n    }\n  }, []);\n\n  // Sort paths by distance\n  paths.sort((a, b) => {\n    const [ aBegins, aEnds ] = [\n      centroid(a.begins).geometry.coordinates,\n      centroid(a.ends).geometry.coordinates\n    ];\n\n    const [ bBegins, bEnds ] = [\n      centroid(b.begins).geometry.coordinates,\n      centroid(b.ends).geometry.coordinates\n    ]; \n\n    const distA = Math.sqrt(Math.pow(aEnds[0] - aBegins[0], 2) + Math.pow(aEnds[1] - aBegins[1], 2));\n    const distB = Math.sqrt(Math.pow(bEnds[0] - bBegins[0], 2) + Math.pow(bEnds[1] - bBegins[1], 2));\n\n    return distA - distB;\n  });\n\n  return paths;\n}\n\n/**\n * Because (fortunately) our data is static, the data store\n * is just a convenience wrapper over the JSON data files. \n */\nexport default class DataStore {\n\n  constructor() {\n    this.actors = [];\n    this.places = [];\n\n    // Geo-bounds of all places in the dataset\n    this.geoBounds = null;\n\n    // The 'life paths', pairs of coordinates for actors'\n    // begins_in/ends_in properties\n    this.lifePaths = [];\n\n    this.search = new JsSearch.Search('@id');   \n    this.search.tokenizer = {\n      tokenize(text) {\n        return text\n          .replace(/[.,'\"#!$%^&*;:{}=\\-_`~()]/g, '')\n          .split(/[\\s,-]+/)\n      }\n    };\n\n    this.search.addIndex([ 'properties', 'title' ]); \n  }\n\n  load() {\n    const loadFile = entityType => \n      axios.get(`data/items_${entityType}.json`).then(response =>\n        response.data.results.reduce((items, next) => items.concat(next.features), []));\n    \n    const responses = Promise.all([\n      loadFile('actor'),\n      loadFile('place')\n    ]);\n\n    return responses.then(arr => {\n      const [ actors, places ] = arr;\n\n      this.actors = actors;\n      this.places = places;\n\n      this.items = this.actors.concat(this.places);\n\n      this.geoBounds = computeGeoBounds(places);\n      this.lifePaths = computeLifePaths(this, actors);\n\n      this.search.addDocuments([ ...actors, ...places ]);\n    });\n  }\n\n  findById(id) {\n    return this.items.find(i => i['@id'] === id);\n  }\n\n  searchAll(query) {\n    return this.search.search(query.toLowerCase());\n  }\n\n  getPlaceWithLocation(id) {\n    return this.places.find(place => place.relations.find(rel => \n      rel.relationTo === id && rel.relationType === CRM.P53_has_former_or_current_location));\n  }\n\n  getActorsWithLocation(id) {\n    const relevantTypes = [\n      CRM.OA8_begins_in,\n      CRM.OA9_ends_in,\n      CRM.P74_has_current_or_former_residence\n    ];\n\n    return this.actors.filter(actor => actor.relations.find(rel => \n      rel.relationTo === id && relevantTypes.includes(rel.relationType)));\n  }\n  \n}\n","import React, { useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport LoadingScreen from './splash/LoadingScreen';\nimport * as serviceWorker from './serviceWorker';\nimport DataStore from './store/DataStore';\nimport L from 'leaflet';\n\n// Fix missing Leaflet marker images\n// Cf. https://github.com/PaulLeCam/react-leaflet/issues/453\ndelete L.Icon.Default.prototype._getIconUrl;\n\nL.Icon.Default.mergeOptions({\n    iconRetinaUrl: 'images/leaflet/marker-icon-2x.png',\n    iconUrl: 'images/leaflet/marker-icon.png',\n    shadowUrl: 'images/leaflet/marker-shadow.png'\n});\n\n// A simple start helper that loads the data and then switches to the app\nconst Launcher = () => {\n\n  const isDesktop = window.screen.availWidth > 799;\n\n  const [ isLoading, setIsLoading ] = useState(true);\n\n  const store = new DataStore();\n  store.load().then(() => setIsLoading(false));\n  \n  return (\n    <>{ isLoading ? <LoadingScreen /> : <App store={store} isDesktop={isDesktop} /> }</>\n  )\n\n}\n\nReactDOM.render(\n  <Launcher />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","var map = {\n\t\"./messages_de.json\": 74\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 73;"],"sourceRoot":""}